<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skill Audit Registry | On-Chain Security Audits</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            padding: 3rem 0;
            border-bottom: 1px solid #2a2a4a;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #00d4aa 0%, #7b68ee 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: #888;
            font-size: 1.1rem;
        }

        .contract-info {
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid #00d4aa;
            border-radius: 8px;
            padding: 1rem;
            margin: 2rem 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        .contract-info a {
            color: #00d4aa;
            text-decoration: none;
        }

        .contract-info a:hover {
            text-decoration: underline;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 600;
            color: #00d4aa;
        }

        .stat-label {
            color: #888;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .section {
            margin: 3rem 0;
        }

        h2 {
            color: #fff;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .query-form {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .input-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        input[type="text"], textarea {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #2a2a4a;
            border-radius: 8px;
            padding: 0.75rem;
            color: #e0e0e0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #00d4aa;
        }

        button {
            background: linear-gradient(135deg, #00d4aa 0%, #00a88a 100%);
            color: #000;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 212, 170, 0.3);
        }

        .results {
            margin-top: 1.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            display: none;
        }

        .results.show {
            display: block;
        }

        .risk-level {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .risk-clean { background: #00d4aa; color: #000; }
        .risk-low { background: #7b68ee; color: #fff; }
        .risk-medium { background: #f4a300; color: #000; }
        .risk-high { background: #ff6b6b; color: #fff; }
        .risk-critical { background: #ff0000; color: #fff; }

        .audit-item {
            padding: 1rem;
            border-bottom: 1px solid #2a2a4a;
        }

        .audit-item:last-child {
            border-bottom: none;
        }

        .audit-meta {
            color: #888;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        footer {
            text-align: center;
            padding: 2rem;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #2a2a4a;
            margin-top: 3rem;
        }

        footer a {
            color: #00d4aa;
            text-decoration: none;
        }

        .network-badge {
            display: inline-block;
            background: #0052ff;
            color: #fff;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        @media (max-width: 600px) {
            .stats {
                grid-template-columns: 1fr;
            }
            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚õìÔ∏è Skill Audit Registry</h1>
            <p class="subtitle">On-chain security audits for agent skills</p>
        </header>

        <div class="contract-info">
            üìú Contract: <a href="https://basescan.org/address/0xfcF90AB03A12200d9Ed93Ae7837F433920b6D062" target="_blank">0xfcF90AB03A12200d9Ed93Ae7837F433920b6D062</a>
            <span class="network-badge">Base</span>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="total-skills">-</div>
                <div class="stat-label">Skills Audited</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-audits">-</div>
                <div class="stat-label">Total Audits</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="flagged-count">-</div>
                <div class="stat-label">Flagged (‚â•Medium)</div>
            </div>
        </div>

        <section class="section">
            <h2>üîç Query Audits</h2>
            <div class="query-form">
                <div class="input-group">
                    <label>Skill Content (paste SKILL.md contents)</label>
                    <textarea id="skill-content" rows="4" placeholder="Paste skill.md content here..."></textarea>
                </div>
                <div class="input-group">
                    <label>Or enter skill hash directly</label>
                    <input type="text" id="skill-hash" placeholder="0x..." />
                </div>
                <button onclick="queryAudit()">Query Audits</button>
                <div id="query-results" class="results"></div>
            </div>
        </section>

        <section class="section">
            <h2>üìù Submit Audit</h2>
            <div class="query-form">
                <p style="color: #888; margin-bottom: 1rem;">Connect your wallet to submit an audit. Use the <a href="https://github.com/reldothescribe/skill-scanner" target="_blank" style="color: #00d4aa;">skill-scanner</a> CLI to generate audit data.</p>
                <button onclick="connectWallet()">Connect Wallet</button>
                <div id="wallet-status" style="margin-top: 1rem; color: #888;"></div>
            </div>
        </section>

        <footer>
            Built by <a href="https://x.com/ReldoTheScribe" target="_blank">@ReldoTheScribe</a> | 
            <a href="https://github.com/reldothescribe/skill-audit-registry" target="_blank">GitHub</a> |
            <a href="https://github.com/reldothescribe/skill-scanner" target="_blank">skill-scanner CLI</a>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
    <script>
        const CONTRACT_ADDRESS = '0xfcF90AB03A12200d9Ed93Ae7837F433920b6D062';
        const RPC_URL = 'https://mainnet.base.org';
        
        const ABI = [
            "function getTotalSkillsAudited() view returns (uint256)",
            "function getAuditCount(bytes32 skillHash) view returns (uint256)",
            "function getLatestAudit(bytes32 skillHash) view returns (tuple(bytes32 skillHash, uint8 riskLevel, uint256 riskScore, string scannerVersion, address auditor, uint256 timestamp, string notes))",
            "function getAudits(bytes32 skillHash) view returns (tuple(bytes32 skillHash, uint8 riskLevel, uint256 riskScore, string scannerVersion, address auditor, uint256 timestamp, string notes)[])",
            "function isFlagged(bytes32 skillHash) view returns (bool)",
            "function computeSkillHash(string content) pure returns (bytes32)",
            "function submitAudit(bytes32 skillHash, uint8 riskLevel, uint256 riskScore, string scannerVersion, string notes)"
        ];

        const riskLabels = ['CLEAN', 'LOW', 'MEDIUM', 'HIGH', 'CRITICAL'];
        const riskClasses = ['risk-clean', 'risk-low', 'risk-medium', 'risk-high', 'risk-critical'];

        let provider, contract, signer;

        async function init() {
            provider = new ethers.JsonRpcProvider(RPC_URL);
            contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);
            
            try {
                const total = await contract.getTotalSkillsAudited();
                document.getElementById('total-skills').textContent = total.toString();
                document.getElementById('total-audits').textContent = total.toString(); // Simplified
                document.getElementById('flagged-count').textContent = '0'; // Would need iteration
            } catch (e) {
                console.log('Stats loading...', e);
            }
        }

        async function queryAudit() {
            const content = document.getElementById('skill-content').value;
            const hashInput = document.getElementById('skill-hash').value;
            const resultsDiv = document.getElementById('query-results');
            
            let skillHash;
            
            if (content.trim()) {
                skillHash = ethers.keccak256(ethers.toUtf8Bytes(content));
            } else if (hashInput.trim()) {
                skillHash = hashInput;
            } else {
                resultsDiv.innerHTML = '<span style="color: #ff6b6b;">Please enter skill content or hash</span>';
                resultsDiv.classList.add('show');
                return;
            }

            try {
                const count = await contract.getAuditCount(skillHash);
                
                if (count == 0) {
                    resultsDiv.innerHTML = `<span style="color: #888;">No audits found for this skill</span><br><code>${skillHash}</code>`;
                    resultsDiv.classList.add('show');
                    return;
                }

                const audits = await contract.getAudits(skillHash);
                const flagged = await contract.isFlagged(skillHash);

                let html = `<strong>Found ${count} audit(s)</strong> ${flagged ? '<span class="risk-level risk-high">‚ö†Ô∏è FLAGGED</span>' : ''}<br><br>`;
                
                for (const audit of audits.reverse()) {
                    const date = new Date(Number(audit.timestamp) * 1000).toLocaleString();
                    html += `
                        <div class="audit-item">
                            <span class="risk-level ${riskClasses[audit.riskLevel]}">${riskLabels[audit.riskLevel]}</span>
                            Score: ${audit.riskScore.toString()} | v${audit.scannerVersion}
                            <div class="audit-meta">
                                By: ${audit.auditor.slice(0,6)}...${audit.auditor.slice(-4)} | ${date}
                                ${audit.notes ? `<br>Notes: ${audit.notes}` : ''}
                            </div>
                        </div>
                    `;
                }
                
                resultsDiv.innerHTML = html;
                resultsDiv.classList.add('show');
            } catch (e) {
                resultsDiv.innerHTML = `<span style="color: #ff6b6b;">Error: ${e.message}</span>`;
                resultsDiv.classList.add('show');
            }
        }

        async function connectWallet() {
            const status = document.getElementById('wallet-status');
            
            if (!window.ethereum) {
                status.innerHTML = 'No wallet detected. Install MetaMask or similar.';
                return;
            }

            try {
                const browserProvider = new ethers.BrowserProvider(window.ethereum);
                await browserProvider.send("eth_requestAccounts", []);
                signer = await browserProvider.getSigner();
                const address = await signer.getAddress();
                status.innerHTML = `Connected: ${address.slice(0,6)}...${address.slice(-4)}`;
                
                // Check network
                const network = await browserProvider.getNetwork();
                if (network.chainId !== 8453n) {
                    status.innerHTML += '<br><span style="color: #f4a300;">‚ö†Ô∏è Please switch to Base network</span>';
                }
            } catch (e) {
                status.innerHTML = `Error: ${e.message}`;
            }
        }

        init();
    </script>
</body>
</html>
